"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cancellation_1 = require("./cancellation");
/**
 * Wrapper for setTimeout as cancellable async function
 *
 * Example:
 * ```ts
 * console.log("then");
 * await sleep(1000);
 * console.log("now");
 * ```
 */
function sleep(millis, cancellationToken) {
    let timeoutId;
    return new Promise((resolve, reject) => {
        timeoutId = setTimeout(() => {
            resolve();
            timeoutId = (void 0);
        }, millis);
        if (cancellationToken) {
            cancellationToken.register(() => {
                clearTimeout(timeoutId);
                timeoutId = (void 0);
                reject(new cancellation_1.OperationCanceledError(cancellationToken));
            });
        }
    });
}
exports.sleep = sleep;
//# sourceMappingURL=sleep.js.map